#create database
create database online_shopping;
#use database
use online_shopping;


#create a new table
create table customer(
customer_id INT PRIMARY KEY,
first_name VARCHAR(50),
last_name VARCHAR(50),
address VARCHAR(100),
email VARCHAR(100),
phone_number INT
); 

#deletes the old column
alter table customer 
drop column phone_number;
 
  #add new column
 alter table customer add phone_number  varchar(50);
 
#displays all the table details
select * from customer;
select * from products;
select * from orders;
select * from order_items;
select * from payment;


#get all customer's shipment address
select  first_name, address 
from customer;


#sql query list of top 10 orders
select order_id, customer_id, total_price from orders
order by total_price desc limit 10;

#aggregate query sum
#total revenue per person

select c.first_name,c.last_name, sum(o.total_price) as total_price 
from orders o
join customer c on o.customer_id = c.customer_id
group by c.first_name, c.last_name
order by total_price desc;

#average order value per customer
select customer_id ,avg(total_price) as avg_order_value
from orders
group by customer_id;


#joins inner, left, right
#inner join to list orders with customer details
select o.order_id, c.last_name,o.order_date,o.total_price
from orders o
inner join customer c on o.customer_id=c.customer_id;

#left join to show all product +sales
select p.product_name, sum(oi.quantity) as units_sold
from products p
left join order_items oi on p.product_id=oi.product_id
group by p.product_name; 


#left join table for customer who placed order
select c.last_name, o.order_id
from orders o
left join customer c on o.customer_id= c.customer_id;

#subqueries 
#CUSTOMERS who spent more than average total spending
select customer_id, sum(total_price) as total_spent
from orders
group by customer_id
having total_spent > 
			(select avg(total_price) from orders);
            

#product price above category average
select product_id, product_name,price
from products p
where price >
		(select avg (price)
		from products
		where category= p.category);


SELECT 
    YEAR(order_date) AS order_year,
    MONTH(order_date) AS order_month,
    SUM(total_price) AS total_price,
    COUNT(DISTINCT order_id) AS order_volume
FROM orders
GROUP BY 
    YEAR(order_date),
    MONTH(order_date)
ORDER BY 
    order_year,
    order_month;

SELECT
    EXTRACT(YEAR FROM order_date) AS order_year,
    EXTRACT(MONTH FROM order_date) AS order_month,
    SUM(total_price) AS monthly_revenue,
    COUNT(DISTINCT order_id) AS total_orders
FROM orders
GROUP BY 
    EXTRACT(YEAR FROM order_date),
    EXTRACT(MONTH FROM order_date)
ORDER BY 
    order_year,
    order_month;

SELECT
    YEAR(order_date) AS order_year,
    MONTH(order_date) AS order_month,
    SUM(total_price) AS monthly_revenue,
    COUNT(DISTINCT order_id) AS total_orders
FROM orders
WHERE YEAR(order_date) = 2023
GROUP BY 
    YEAR(order_date),
    MONTH(order_date)
ORDER BY 
    order_month;





